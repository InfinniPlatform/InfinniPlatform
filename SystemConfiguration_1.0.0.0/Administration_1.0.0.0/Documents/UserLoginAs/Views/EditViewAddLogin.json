{
  "Id": "97e669f5-bb05-4623-a74e-d1f6d6ad4e5c",
  "__DocumentId": "viewmetadata",
  "__ConfigId": "systemconfig",
  "ParentId": "4800b20f-01fb-4637-a571-398c7c8b2142",
  "Name": "EditViewAddLogin",
  "Caption": "Добавление логина пользователя",
  "Description": "",
  "MetadataType": "EditView",
  "Scripts": [
    {
      "Name": "SaveUserLogin",
      "Body": "\r\nvar selectedItem = context.DataSources['MainDataSource'].getSelectedItem();\r\nvar userAs = context.DataSources['UserListDataSource'].getSelectedItem();\r\nif(selectedItem && userAs) { \r\n\r\n\tvar userLoginAs = {};\r\n\tuserLoginAs.User = {};\r\n\tuserLoginAs.User.Id = userAs.Id;\r\n\tuserLoginAs.User.DisplayName = userAs.UserName;\r\n\tuserLoginAs.LoginAs = {};\r\n\tuserLoginAs.LoginAs.Id = selectedItem.Id;\r\n\tuserLoginAs.LoginAs.DisplayName = selectedItem.UserName;\r\n\t\r\n\t\r\n\tvar dataSourceToSave = context.DataSources['UserLoginAsDataSource'];\r\n\tdataSourceToSave.setSelectedItem(userLoginAs);\r\n\tcontext.Global.executeAction({\r\n\t   SaveAction : {\r\n\t      DataSource : 'UserLoginAsDataSource'\r\n\t   }\t   \r\n\t});\r\n\tcontext.ParentView.getParentView().close();\r\n}\r\n"
    }
  ],
  "DataSources": [
    {
      "DocumentDataSource": {
        "Name": "MainDataSource",
        "ConfigId": "Administration",
        "DocumentId": "User"
      }
    },
    {
      "DocumentDataSource": {
        "Name": "UserListDataSource",
        "ConfigId": "Administration",
        "DocumentId": "User"
      }
    },
    {
      "DocumentDataSource": {
        "Name": "UserLoginAsDataSource",
        "ConfigId": "Administration",
        "DocumentId": "UserLoginAs"
      }
    }
  ],
  "LayoutPanel": {
    "StackPanel": {
      "Items": [
        {
          "Label": {
            "Text": "Выберите пользователя"
          }
        },
        {
          "DataGrid": {
            "Columns": [
              {
                "Text": "Пользователь",
                "DisplayProperty": "UserName"
              }
            ],
            "Items": {
              "PropertyBinding": {
                "DataSource": "UserListDataSource"
              }
            }
          }
        },
        {
          "ToolBar": {
            "Items": [
              {
                "ToolBarButton": {
                  "Text": "OK",
                  "OnClick": {
                    "Name": "SaveUserLogin"
                  }
                }
              }
            ]
          }
        }
      ]
    }
  }
}

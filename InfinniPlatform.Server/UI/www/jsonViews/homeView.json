{
    "$schema": "https://raw.githubusercontent.com/InfinniPlatform/InfinniUI-schema/master/View/View.json",
    "OnLoaded": "{ Subscribe(context, args); }",
    "DataSources": [{
        "RestDataSource": {
            "Name": "AgentsDataSource",
            "GettingParams": {
                "Method": "GET",
                "Path": "/server/agents",
                "Data": {}
            },
            "UpdatingItemsConverter": "{ return args.value.Result.Agents; }"
        }
    }, {
        "RestDataSource": {
            "Name": "AppsDataSource",
            "GettingParams": {
                "Method": "GET",
                "Path": "/server/appsInfo",
                "Data": {
                    "Address": "<%Address%>",
                    "Port": "<%Port%>"
                },
                "Params": {
                    "Address": {
                        "Source": "AgentsDataSource",
                        "Property": "$.Address"
                    },
                    "Port": {
                        "Source": "AgentsDataSource",
                        "Property": "$.Port"
                    }
                }
            },
            "UpdatingItemsConverter": "{ return args.value.Result.FormattedOutput; }",
            "OnSelectedItemChanged": "{ EnableAppButtons(context, args); }",
            "OnItemsUpdated": "{ context.dataSources.TasksDataSource.updateItems(); }"
        }
    }, {
        "RestDataSource": {
            "Name": "TasksDataSource",
            "GettingParams": {
                "Method": "GET",
                "Path": "/server/taskStatus",
                "Data": {
                    "Address": "<%Address%>",
                    "Port": "<%Port%>"
                },
                "Params": {
                    "Address": {
                        "Source": "AgentsDataSource",
                        "Property": "$.Address"
                    },
                    "Port": {
                        "Source": "AgentsDataSource",
                        "Property": "$.Port"
                    }
                }
            },
            "UpdatingItemsConverter": "{ return args.value.Result; }",
            "OnSelectedItemChanged": "{ EnableTaskButtons(context, args); }"
        }
    }],
    "Items": [{
        "TabPanel": {
            "Name": "AgentsTabPanel",
            "HeaderLocation": "Left",
            "Items": {
                "Source": "AgentsDataSource"
            },
            "ItemTemplate": {
                "TabPage": {
                    "Tag": {
                        "Source": "AgentsDataSource",
                        "Property": "#"
                    },
                    "Text": {
                        "Source": "AgentsDataSource",
                        "Property": "#",
                        "Mode": "ToElement",
                        "Converter": {
                            "ToElement": "{ return ConvertAgentInfoHeader(context, args); }"
                        }
                    },
                    "Items": [{
                        "StackPanel": {
                            "ViewMode": "FormGroup",
                            "Orientation": "Horizontal",
                            "Items": [{
                                "Button": {
                                    "Name": "RefreshButton",
                                    "Text": "Refresh",
                                    "OnClick": "{ RefreshDataSources(context, args); }"
                                }
                            }, {
                                "Button": {
                                    "Name": "envVarsButton",
                                    "Text": "Agent environment variables",
                                    "Action": {
                                        "OpenAction": {
                                            "LinkView": {
                                                "AutoView": {
                                                    "OpenMode": "Dialog",
                                                    "DialogWidth": "ExtraLarge",
                                                    "Path": "jsonViews/environmentView.json",
                                                    "Parameters": [{
                                                        "Name": "AgentAddress",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        }
                                                    }, {
                                                        "Name": "AgentPort",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        }
                                                    }, {
                                                        "Name": "AppFullName",
                                                        "Value": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.AppFullName"
                                                        }
                                                    }]
                                                }
                                            }
                                        }
                                    }
                                }
                            }, {
                                "Button": {
                                    "Name": "nodeLogButton",
                                    "Text": "Infinni.Node log",
                                    "Action": {
                                        "OpenAction": {
                                            "LinkView": {
                                                "AutoView": {
                                                    "OpenMode": "Dialog",
                                                    "DialogWidth": "ExtraLarge",
                                                    "Path": "jsonViews/nodeLogView.json",
                                                    "Parameters": [{
                                                        "Name": "AgentAddress",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        }
                                                    }, {
                                                        "Name": "AgentPort",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        }
                                                    }, {
                                                        "Name": "AppFullName",
                                                        "Value": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.AppFullName"
                                                        }
                                                    }]
                                                }
                                            }
                                        }
                                    }
                                }
                            }]
                        }
                    }, {
                        "StackPanel": {
                            "ViewMode": "FormGroup",
                            "Orientation": "Horizontal",
                            "Items": [{
                                "Button": {
                                    "Name": "installButton",
                                    "Text": "Install new app",
                                    "Action": {
                                        "AddAction": {
                                            "SourceValue": {
                                                "Source": "AppsDataSource"
                                            },
                                            "DestinationValue": {
                                                "Source": "AppsDataSource",
                                                "Property": ""
                                            },
                                            "LinkView": {
                                                "AutoView": {
                                                    "OpenMode": "Dialog",
                                                    "DialogWidth": "Large",
                                                    "Path": "jsonViews/installView.json",
                                                    "Parameters": [{
                                                        "Name": "AgentAddress",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        }
                                                    }, {
                                                        "Name": "AgentPort",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        }
                                                    }]
                                                }
                                            }
                                        }
                                    }
                                }
                            }, {
                                "StackPanel": {
                                    "Name": "AppButtonsStackPanel",
                                    "Visible": false,
                                    "ViewMode": "FormGroup",
                                    "Orientation": "Horizontal",
                                    "Items": [{
                                        "Button": {
                                            "Name": "uninstallButton",
                                            "Text": "Uninstall",
                                            "Action": {
                                                "ServerAction": {
                                                    "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                    "Path": "/server/uninstall?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                    "Method": "POST",
                                                    "Data": {
                                                        "AppName": "<%appName%>",
                                                        "Version": "<%version%>",
                                                        "Instance": "<%instance%>"
                                                    },
                                                    "Params": {
                                                        "serverAddress": "localhost",
                                                        "serverPort": "9901",
                                                        "agentAddress": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        },
                                                        "agentPort": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        },
                                                        "appName": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Id"
                                                        },
                                                        "version": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Version"
                                                        },
                                                        "instance": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Instance"
                                                        }
                                                    },
                                                    "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                }
                                            }
                                        }
                                    }, {
                                        "Button": {
                                            "Name": "initButton",
                                            "Text": "Init",
                                            "Action": {
                                                "ServerAction": {
                                                    "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                    "Path": "/server/init?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                    "Method": "POST",
                                                    "Data": {
                                                        "AppName": "<%appName%>",
                                                        "Version": "<%version%>",
                                                        "Instance": "<%instance%>",
                                                        "Timeout": null
                                                    },
                                                    "Params": {
                                                        "serverAddress": "localhost",
                                                        "serverPort": "9901",
                                                        "agentAddress": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        },
                                                        "agentPort": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        },
                                                        "appName": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Id"
                                                        },
                                                        "version": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Version"
                                                        },
                                                        "instance": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Instance"
                                                        }
                                                    },
                                                    "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                }
                                            }
                                        }
                                    }, {
                                        "Button": {
                                            "Name": "startButton",
                                            "Text": "Start",
                                            "Action": {
                                                "ServerAction": {
                                                    "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                    "Path": "/server/start?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                    "Method": "POST",
                                                    "Data": {
                                                        "AppName": "<%appName%>",
                                                        "Version": "<%version%>",
                                                        "Instance": "<%instance%>",
                                                        "Timeout": null
                                                    },
                                                    "Params": {
                                                        "serverAddress": "localhost",
                                                        "serverPort": "9901",
                                                        "agentAddress": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        },
                                                        "agentPort": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        },
                                                        "appName": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Id"
                                                        },
                                                        "version": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Version"
                                                        },
                                                        "instance": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Instance"
                                                        }
                                                    },
                                                    "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                }
                                            }
                                        }
                                    }, {
                                        "Button": {
                                            "Name": "stopButton",
                                            "Text": "Stop",
                                            "Action": {
                                                "ServerAction": {
                                                    "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                    "Path": "/server/stop?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                    "Method": "POST",
                                                    "Data": {
                                                        "AppName": "<%appName%>",
                                                        "Version": "<%version%>",
                                                        "Instance": "<%instance%>",
                                                        "Timeout": null
                                                    },
                                                    "Params": {
                                                        "serverAddress": "localhost",
                                                        "serverPort": "9901",
                                                        "agentAddress": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        },
                                                        "agentPort": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        },
                                                        "appName": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Id"
                                                        },
                                                        "version": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Version"
                                                        },
                                                        "instance": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Instance"
                                                        }
                                                    },
                                                    "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                }
                                            }
                                        }
                                    }, {
                                        "Button": {
                                            "Name": "restartButton",
                                            "Text": "Restart",
                                            "Action": {
                                                "ServerAction": {
                                                    "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                    "Path": "/server/restart?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                    "Method": "POST",
                                                    "Data": {
                                                        "AppName": "<%appName%>",
                                                        "Version": "<%version%>",
                                                        "Instance": "<%instance%>",
                                                        "Timeout": null
                                                    },
                                                    "Params": {
                                                        "serverAddress": "localhost",
                                                        "serverPort": "9901",
                                                        "agentAddress": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        },
                                                        "agentPort": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        },
                                                        "appName": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Id"
                                                        },
                                                        "version": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Version"
                                                        },
                                                        "instance": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.Instance"
                                                        }
                                                    },
                                                    "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                }
                                            }
                                        }
                                    }, {
                                        "Button": {
                                            "Name": "appConfigsButton",
                                            "Text": "App configs",
                                            "Action": {
                                                "OpenAction": {
                                                    "LinkView": {
                                                        "AutoView": {
                                                            "OpenMode": "Dialog",
                                                            "Path": "jsonViews/configView.json",
                                                            "Parameters": [{
                                                                "Name": "AgentAddress",
                                                                "Value": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Address"
                                                                }
                                                            }, {
                                                                "Name": "AgentPort",
                                                                "Value": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Port"
                                                                }
                                                            }, {
                                                                "Name": "AppFullName",
                                                                "Value": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "$.AppFullName"
                                                                }
                                                            }]
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }, {
                                        "Button": {
                                            "Name": "appLogsButton",
                                            "Text": "App logs",
                                            "Action": {
                                                "OpenAction": {
                                                    "LinkView": {
                                                        "AutoView": {
                                                            "OpenMode": "Dialog",
                                                            "DialogWidth": "ExtraLarge",
                                                            "Path": "jsonViews/appLogView.json",
                                                            "Parameters": [{
                                                                "Name": "AgentAddress",
                                                                "Value": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Address"
                                                                }
                                                            }, {
                                                                "Name": "AgentPort",
                                                                "Value": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Port"
                                                                }
                                                            }, {
                                                                "Name": "AppFullName",
                                                                "Value": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "$.AppFullName"
                                                                }
                                                            }]
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }]
                                }
                            }]
                        }
                    }, {
                        "DataGrid": {
                            "Name": "AppsGrid",
                            "Columns": [{
                                "Header": "Id",
                                "CellProperty": "Id"
                            }, {
                                "Header": "Version",
                                "CellProperty": "Version"
                            }, {
                                "Header": "Instance",
                                "CellProperty": "Instance"
                            }, {
                                "Header": "Full app name",
                                "CellProperty": "AppFullName"
                            }, {
                                "Header": "Process State",
                                "CellProperty": "ProcessInfo.State"
                            }],
                            "Items": {
                                "Source": "AppsDataSource"
                            },
                            "ShowSelectors": false
                        }
                    }, {
                        "StackPanel": {
                            "Name": "TaskButtonsStackPanel",
                            "ViewMode": "FormGroup",
                            "Orientation": "Horizontal",
                            "Items": [{
                                "Button": {
                                    "Name": "OutputButton",
                                    "Text": "Show output",
                                    "Visible": false,
                                    "Action": {
                                        "OpenAction": {
                                            "LinkView": {
                                                "AutoView": {
                                                    "OpenMode": "Dialog",
                                                    "DialogWidth": "Large",
                                                    "Path": "jsonViews/taskView.json",
                                                    "Parameters": [{
                                                        "Name": "Task",
                                                        "Value": {
                                                            "Source": "TasksDataSource",
                                                            "Property": "$"
                                                        }
                                                    }, {
                                                        "Name": "AgentAddress",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        }
                                                    }, {
                                                        "Name": "AgentPort",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        }
                                                    }]
                                                }
                                            }
                                        }
                                    }
                                }
                            }]
                        }
                    }, {
                        "DataGrid": {
                            "Name": "TasksGrid",
                            "Columns": [{
                                "Header": "Description",
                                "CellProperty": "Description"
                            }, {
                                "Header": "State",
                                "CellProperty": "State"
                            }],
                            "Items": {
                                "Source": "TasksDataSource"
                            },
                            "ShowSelectors": false
                        }
                    }]
                }
            },
            "OnSelectedItemChanged": "{ UpdateAppsGrid(context, args); }"
        }
    }]
}
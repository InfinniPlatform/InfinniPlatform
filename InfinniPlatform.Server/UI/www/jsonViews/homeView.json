{
    "$schema": "https://raw.githubusercontent.com/InfinniPlatform/InfinniUI-schema/master/View/View.json",
    "OnLoaded": "{ Subscribe(context, args); }",
    "DataSources": [{
        "RestDataSource": {
            "Name": "AgentsDataSource",
            "GettingParams": {
                "Method": "GET",
                "Path": "/server/agents",
                "Data": {}
            },
            "UpdatingItemsConverter": "{ return args.value.Result.Agents; }"
        }
    }, {
        "RestDataSource": {
            "Name": "AppsDataSource",
            "GettingParams": {
                "Method": "GET",
                "Path": "/server/appsInfo",
                "Data": {
                    "Address": "<%Address%>",
                    "Port": "<%Port%>"
                },
                "Params": {
                    "Address": {
                        "Source": "AgentsDataSource",
                        "Property": "$.Address"
                    },
                    "Port": {
                        "Source": "AgentsDataSource",
                        "Property": "$.Port"
                    }
                }
            },
            "UpdatingItemsConverter": "{ return args.value.Result.FormattedOutput; }",
            "OnItemsUpdated": "{ context.dataSources.TasksDataSource.updateItems(); }"
        }
    }, {
        "RestDataSource": {
            "Name": "TasksDataSource",
            "GettingParams": {
                "Method": "GET",
                "Path": "/server/taskStatus",
                "Data": {
                    "Address": "<%Address%>",
                    "Port": "<%Port%>"
                },
                "Params": {
                    "Address": {
                        "Source": "AgentsDataSource",
                        "Property": "$.Address"
                    },
                    "Port": {
                        "Source": "AgentsDataSource",
                        "Property": "$.Port"
                    }
                }
            },
            "UpdatingItemsConverter": "{ return args.value.Result; }",
            "OnSelectedItemChanged": "{ EnableTaskButtons(context, args); }"
        }
    }],
    "Items": [{
        "TabPanel": {
            "Name": "AgentsTabPanel",
            "HeaderLocation": "Top",
            "Items": {
                "Source": "AgentsDataSource"
            },
            "ItemTemplate": {
                "TabPage": {
                    "Tag": {
                        "Source": "AgentsDataSource",
                        "Property": "#"
                    },
                    "Text": {
                        "Source": "AgentsDataSource",
                        "Property": "#",
                        "Mode": "ToElement",
                        "Converter": {
                            "ToElement": "{ return ConvertAgentInfoHeader(context, args); }"
                        }
                    },
                    "Items": [{
                        "StackPanel": {
                            "ViewMode": "FormGroup",
                            "Orientation": "Horizontal",
                            "Items": [{
                                "Button": {
                                    "Name": "RefreshButton",
                                    "ToolTip": "Update agent info",
                                    "OnClick": "{ RefreshDataSources(context, args); }",
                                    "ContentTemplate": {
                                        "StackPanel": {
                                            "ViewMode": "Base",
                                            "Orientation": "Horizontal",
                                            "Items": [{
                                                "Icon": {
                                                    "Value": "rotate-right"
                                                }
                                            }, {
                                                "Label": {
                                                    "Value": "&nbsp;Refresh",
                                                    "EscapeHtml": false
                                                }
                                            }]
                                        }
                                    }
                                }
                            }, {
                                "Button": {
                                    "Name": "envVarsButton",
                                    "ToolTip": "Show agent machine environment variables",
                                    "Action": {
                                        "OpenAction": {
                                            "LinkView": {
                                                "AutoView": {
                                                    "OpenMode": "Dialog",
                                                    "DialogWidth": "ExtraLarge",
                                                    "Path": "jsonViews/environmentView.json",
                                                    "Parameters": [{
                                                        "Name": "AgentAddress",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        }
                                                    }, {
                                                        "Name": "AgentPort",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        }
                                                    }, {
                                                        "Name": "AppFullName",
                                                        "Value": {
                                                            "Source": "AppsDataSource",
                                                            "Property": "$.AppFullName"
                                                        }
                                                    }]
                                                }
                                            }
                                        }
                                    },
                                    "ContentTemplate": {
                                        "StackPanel": {
                                            "ViewMode": "Base",
                                            "Orientation": "Horizontal",
                                            "Items": [{
                                                "Icon": {
                                                    "Value": "envira"
                                                }
                                            }, {
                                                "Label": {
                                                    "Value": "&nbsp;Environment variables",
                                                    "EscapeHtml": false
                                                }
                                            }]
                                        }
                                    }
                                }
                            }, {
                                "Button": {
                                    "Name": "nodeLogButton",
                                    "ToolTip": "Open Infinni.Node log in tab",
                                    "OnClick": "{ OpenNodeLogInTab(context, args); }",
                                    "ContentTemplate": {
                                        "StackPanel": {
                                            "ViewMode": "Base",
                                            "Orientation": "Horizontal",
                                            "Items": [{
                                                "Label": {
                                                    "Value": "Infinni.Node log&nbsp;",
                                                    "EscapeHtml": false
                                                }
                                            }, {
                                                "Icon": {
                                                    "Value": "external-link"
                                                }
                                            }]
                                        }
                                    }
                                }
                            }, {
                                "Button": {
                                    "Name": "perfLogTabButton",
                                    "ToolTip": "Download Infinni.Node log file",
                                    "OnClick": "{ DownloadNodeLogFile(context, args); }",
                                    "ContentTemplate": {
                                        "Icon": {
                                            "Value": "download"
                                        }
                                    }
                                }
                            }]
                        }
                    }, {
                        "Button": {
                            "Name": "installButton",
                            "ToolTip": "Install new app",
                            "Action": {
                                "AddAction": {
                                    "SourceValue": {
                                        "Source": "AppsDataSource"
                                    },
                                    "DestinationValue": {
                                        "Source": "AppsDataSource",
                                        "Property": ""
                                    },
                                    "LinkView": {
                                        "AutoView": {
                                            "OpenMode": "Dialog",
                                            "DialogWidth": "Large",
                                            "Path": "jsonViews/installView.json",
                                            "Parameters": [{
                                                "Name": "AgentAddress",
                                                "Value": {
                                                    "Source": "AgentsDataSource",
                                                    "Property": "$.Address"
                                                }
                                            }, {
                                                "Name": "AgentPort",
                                                "Value": {
                                                    "Source": "AgentsDataSource",
                                                    "Property": "$.Port"
                                                }
                                            }]
                                        }
                                    }
                                }
                            },
                            "ContentTemplate": {
                                "StackPanel": {
                                    "ViewMode": "Base",
                                    "Orientation": "Horizontal",
                                    "Items": [{
                                        "Icon": {
                                            "Value": "download"
                                        }
                                    }, {
                                        "Label": {
                                            "Value": "&nbsp;Install",
                                            "EscapeHtml": false
                                        }
                                    }]
                                }
                            }
                        }
                    }, {
                        "StackPanel": {
                            "HorizontalAlignment": "Stretch",
                            "ItemTemplate": {
                                "Panel": {
                                    "Collapsible": true,
                                    "Collapsed": true,
                                    "HeaderTemplate": {
                                        "StackPanel": {
                                            "ViewMode": "FormGroup",
                                            "Orientation": "Horizontal",
                                            "Items": [{
                                                "Label": {
                                                    "Value": {
                                                        "Source": "AppsDataSource",
                                                        "Property": "#.Id"
                                                    }
                                                }
                                            }, {
                                                "Label": {
                                                    "Value": {
                                                        "Source": "AppsDataSource",
                                                        "Property": "#.Version"
                                                    }
                                                }
                                            }, {
                                                "Label": {
                                                    "Value": {
                                                        "Source": "AppsDataSource",
                                                        "Property": "#.Instance"
                                                    }
                                                }
                                            }, {
                                                "Label": {
                                                    "Value": {
                                                        "Source": "AppsDataSource",
                                                        "Property": "#.AppFullName"
                                                    }
                                                }
                                            }, {
                                                "Label": {
                                                    "Value": {
                                                        "Source": "AppsDataSource",
                                                        "Property": "#.ProcessInfo.State"
                                                    }
                                                }
                                            }]
                                        }
                                    },
                                    "Items": [{
                                        "StackPanel": {
                                            "ViewMode": "FormGroup",
                                            "Orientation": "Horizontal",
                                            "Items": [{
                                                "Button": {
                                                    "ToolTip": "Uninstall app",
                                                    "Action": {
                                                        "ServerAction": {
                                                            "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                            "Path": "/server/uninstall?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                            "Method": "POST",
                                                            "Data": {
                                                                "AppName": "<%appName%>",
                                                                "Version": "<%version%>",
                                                                "Instance": "<%instance%>"
                                                            },
                                                            "Params": {
                                                                "serverAddress": "localhost",
                                                                "serverPort": "9901",
                                                                "agentAddress": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Address"
                                                                },
                                                                "agentPort": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Port"
                                                                },
                                                                "appName": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Id"
                                                                },
                                                                "version": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Version"
                                                                },
                                                                "instance": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Instance"
                                                                }
                                                            },
                                                            "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                        }
                                                    },
                                                    "ContentTemplate": {
                                                        "StackPanel": {
                                                            "ViewMode": "Base",
                                                            "Orientation": "Horizontal",
                                                            "Items": [{
                                                                "Icon": {
                                                                    "Value": "trash-o"
                                                                }
                                                            }, {
                                                                "Label": {
                                                                    "Value": "&nbsp;Uninstall",
                                                                    "EscapeHtml": false
                                                                }
                                                            }]
                                                        }
                                                    }
                                                }
                                            }, {
                                                "Button": {
                                                    "ToolTip": "Run app initialization logic",
                                                    "Action": {
                                                        "ServerAction": {
                                                            "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                            "Path": "/server/init?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                            "Method": "POST",
                                                            "Data": {
                                                                "AppName": "<%appName%>",
                                                                "Version": "<%version%>",
                                                                "Instance": "<%instance%>",
                                                                "Timeout": null
                                                            },
                                                            "Params": {
                                                                "serverAddress": "localhost",
                                                                "serverPort": "9901",
                                                                "agentAddress": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Address"
                                                                },
                                                                "agentPort": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Port"
                                                                },
                                                                "appName": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Id"
                                                                },
                                                                "version": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Version"
                                                                },
                                                                "instance": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Instance"
                                                                }
                                                            },
                                                            "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                        }
                                                    },
                                                    "ContentTemplate": {
                                                        "StackPanel": {
                                                            "ViewMode": "Base",
                                                            "Orientation": "Horizontal",
                                                            "Items": [{
                                                                "Icon": {
                                                                    "Value": "wrench"
                                                                }
                                                            }, {
                                                                "Label": {
                                                                    "Value": "&nbsp;Init",
                                                                    "EscapeHtml": false
                                                                }
                                                            }]
                                                        }
                                                    }
                                                }
                                            }, {
                                                "Button": {
                                                    "ToolTip": "Start app",
                                                    "Action": {
                                                        "ServerAction": {
                                                            "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                            "Path": "/server/start?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                            "Method": "POST",
                                                            "Data": {
                                                                "AppName": "<%appName%>",
                                                                "Version": "<%version%>",
                                                                "Instance": "<%instance%>",
                                                                "Timeout": null
                                                            },
                                                            "Params": {
                                                                "serverAddress": "localhost",
                                                                "serverPort": "9901",
                                                                "agentAddress": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Address"
                                                                },
                                                                "agentPort": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Port"
                                                                },
                                                                "appName": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Id"
                                                                },
                                                                "version": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Version"
                                                                },
                                                                "instance": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Instance"
                                                                }
                                                            },
                                                            "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                        }
                                                    },
                                                    "ContentTemplate": {
                                                        "StackPanel": {
                                                            "ViewMode": "Base",
                                                            "Orientation": "Horizontal",
                                                            "Items": [{
                                                                "Icon": {
                                                                    "Value": "play"
                                                                }
                                                            }, {
                                                                "Label": {
                                                                    "Value": "&nbsp;Start",
                                                                    "EscapeHtml": false
                                                                }
                                                            }]
                                                        }
                                                    }
                                                }
                                            }, {
                                                "Button": {
                                                    "ToolTip": "Stop app",
                                                    "Action": {
                                                        "ServerAction": {
                                                            "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                            "Path": "/server/stop?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                            "Method": "POST",
                                                            "Data": {
                                                                "AppName": "<%appName%>",
                                                                "Version": "<%version%>",
                                                                "Instance": "<%instance%>",
                                                                "Timeout": null
                                                            },
                                                            "Params": {
                                                                "serverAddress": "localhost",
                                                                "serverPort": "9901",
                                                                "agentAddress": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Address"
                                                                },
                                                                "agentPort": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Port"
                                                                },
                                                                "appName": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Id"
                                                                },
                                                                "version": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Version"
                                                                },
                                                                "instance": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Instance"
                                                                }
                                                            },
                                                            "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                        }
                                                    },
                                                    "ContentTemplate": {
                                                        "StackPanel": {
                                                            "ViewMode": "Base",
                                                            "Orientation": "Horizontal",
                                                            "Items": [{
                                                                "Icon": {
                                                                    "Value": "stop"
                                                                }
                                                            }, {
                                                                "Label": {
                                                                    "Value": "&nbsp;Stop",
                                                                    "EscapeHtml": false
                                                                }
                                                            }]
                                                        }
                                                    }
                                                }
                                            }, {
                                                "Button": {
                                                    "ToolTip": "Restart app",
                                                    "Action": {
                                                        "ServerAction": {
                                                            "Origin": "http://<%serverAddress%>:<%serverPort%>",
                                                            "Path": "/server/restart?Address=<%agentAddress%>&Port=<%agentPort%>",
                                                            "Method": "POST",
                                                            "Data": {
                                                                "AppName": "<%appName%>",
                                                                "Version": "<%version%>",
                                                                "Instance": "<%instance%>",
                                                                "Timeout": null
                                                            },
                                                            "Params": {
                                                                "serverAddress": "localhost",
                                                                "serverPort": "9901",
                                                                "agentAddress": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Address"
                                                                },
                                                                "agentPort": {
                                                                    "Source": "AgentsDataSource",
                                                                    "Property": "$.Port"
                                                                },
                                                                "appName": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Id"
                                                                },
                                                                "version": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Version"
                                                                },
                                                                "instance": {
                                                                    "Source": "AppsDataSource",
                                                                    "Property": "#.Instance"
                                                                }
                                                            },
                                                            "OnSuccess": "{ RefreshAppsDataSource(context, args); }"
                                                        }
                                                    },
                                                    "ContentTemplate": {
                                                        "StackPanel": {
                                                            "ViewMode": "Base",
                                                            "Orientation": "Horizontal",
                                                            "Items": [{
                                                                "Icon": {
                                                                    "Value": "refresh"
                                                                }
                                                            }, {
                                                                "Label": {
                                                                    "Value": "&nbsp;Restart",
                                                                    "EscapeHtml": false
                                                                }
                                                            }]
                                                        }
                                                    }
                                                }
                                            }, {
                                                "Button": {
                                                    "ToolTip": "Read and edit app configs",
                                                    "Action": {
                                                        "OpenAction": {
                                                            "LinkView": {
                                                                "AutoView": {
                                                                    "OpenMode": "Dialog",
                                                                    "Path": "jsonViews/configView.json",
                                                                    "Parameters": [{
                                                                        "Name": "AgentAddress",
                                                                        "Value": {
                                                                            "Source": "AgentsDataSource",
                                                                            "Property": "$.Address"
                                                                        }
                                                                    }, {
                                                                        "Name": "AgentPort",
                                                                        "Value": {
                                                                            "Source": "AgentsDataSource",
                                                                            "Property": "$.Port"
                                                                        }
                                                                    }, {
                                                                        "Name": "AppFullName",
                                                                        "Value": {
                                                                            "Source": "AppsDataSource",
                                                                            "Property": "$.AppFullName"
                                                                        }
                                                                    }]
                                                                }
                                                            }
                                                        }
                                                    },
                                                    "ContentTemplate": {
                                                        "StackPanel": {
                                                            "ViewMode": "Base",
                                                            "Orientation": "Horizontal",
                                                            "Items": [{
                                                                "Icon": {
                                                                    "Value": "file-code-o"
                                                                }
                                                            }, {
                                                                "Label": {
                                                                    "Value": "&nbsp;Configs",
                                                                    "EscapeHtml": false
                                                                }
                                                            }]
                                                        }
                                                    }
                                                }
                                            }, {
                                                "StackPanel": {
                                                    "ViewMode": "FormGroup",
                                                    "Orientation": "Horizontal",
                                                    "Items": [{
                                                        "Button": {
                                                            "ToolTip": "Open events log in tab",
                                                            "OnClick": "{ OpenEventsLogInTab(context, args); }",
                                                            "ContentTemplate": {
                                                                "StackPanel": {
                                                                    "ViewMode": "Base",
                                                                    "Orientation": "Horizontal",
                                                                    "Items": [{
                                                                        "Label": {
                                                                            "Value": "Events log&nbsp;",
                                                                            "EscapeHtml": false
                                                                        }
                                                                    }, {
                                                                        "Icon": {
                                                                            "Value": "external-link"
                                                                        }
                                                                    }]
                                                                }
                                                            }
                                                        }
                                                    }, {
                                                        "Button": {
                                                            "ToolTip": "Download events log file",
                                                            "OnClick": "{ DownloadEventsLogFile(context, args); }",
                                                            "ContentTemplate": {
                                                                "Icon": {
                                                                    "Value": "download"
                                                                }
                                                            }
                                                        }
                                                    }]
                                                }
                                            }, {
                                                "StackPanel": {
                                                    "ViewMode": "Base",
                                                    "Orientation": "Horizontal",
                                                    "Items": [{
                                                        "Button": {
                                                            "ToolTip": "Open performance log in tab",
                                                            "OnClick": "{ OpenPerfLogInTab(context, args); }",
                                                            "ContentTemplate": {
                                                                "StackPanel": {
                                                                    "ViewMode": "Base",
                                                                    "Orientation": "Horizontal",
                                                                    "Items": [{
                                                                        "Label": {
                                                                            "Value": "Performance log&nbsp;",
                                                                            "EscapeHtml": false
                                                                        }
                                                                    }, {
                                                                        "Icon": {
                                                                            "Value": "external-link"
                                                                        }
                                                                    }]
                                                                }
                                                            }
                                                        }
                                                    }, {
                                                        "Button": {
                                                            "ToolTip": "Download performance log file",
                                                            "OnClick": "{ DownloadPerfLogFile(context, args); }",
                                                            "ContentTemplate": {
                                                                "Icon": {
                                                                    "Value": "download"
                                                                }
                                                            }
                                                        }
                                                    }]
                                                }
                                            }]
                                        }
                                    }]
                                }
                            },
                            "Items": {
                                "Source": "AppsDataSource"
                            }
                        }
                    }, {
                        "StackPanel": {
                            "Name": "TaskButtonsStackPanel",
                            "ViewMode": "FormGroup",
                            "Orientation": "Horizontal",
                            "Items": [{
                                "Button": {
                                    "Name": "OutputButton",
                                    "Text": "Show output",
                                    "Visible": false,
                                    "Action": {
                                        "OpenAction": {
                                            "LinkView": {
                                                "AutoView": {
                                                    "OpenMode": "Dialog",
                                                    "DialogWidth": "Large",
                                                    "Path": "jsonViews/taskView.json",
                                                    "Parameters": [{
                                                        "Name": "Task",
                                                        "Value": {
                                                            "Source": "TasksDataSource",
                                                            "Property": "$"
                                                        }
                                                    }, {
                                                        "Name": "AgentAddress",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Address"
                                                        }
                                                    }, {
                                                        "Name": "AgentPort",
                                                        "Value": {
                                                            "Source": "AgentsDataSource",
                                                            "Property": "$.Port"
                                                        }
                                                    }]
                                                }
                                            }
                                        }
                                    }
                                }
                            }]
                        }
                    }, {
                        "DataGrid": {
                            "Name": "TasksGrid",
                            "Columns": [{
                                "Header": "Description",
                                "CellProperty": "Description"
                            }, {
                                "Header": "State",
                                "CellProperty": "State"
                            }],
                            "Items": {
                                "Source": "TasksDataSource"
                            },
                            "ShowSelectors": false
                        }
                    }]
                }
            },
            "OnSelectedItemChanged": "{ UpdateAppsGrid(context, args); }"
        }
    }]
}
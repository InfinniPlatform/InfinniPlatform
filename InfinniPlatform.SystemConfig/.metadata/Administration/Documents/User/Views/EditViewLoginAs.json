{
  "Id": "695e369a-c059-4d5a-bda0-17bf6ebb019c",
  "__DocumentId": "viewmetadata",
  "__ConfigId": "systemconfig",
  "ParentId": "30700424-13b6-450b-8b91-53821c143cdc",
  "Name": "EditViewLoginAs",
  "Caption": "Форма редактирования пользователя для подключения",
  "Description": "",
  "MetadataType": "EditView",
  "Text": "Добавление пользователя для подключения",
  "Scripts": [
    {
      "Name": "ViewLoaded",
      "Body": "\r\nif(context.DataSources['UserLoginAsDataSource'].getQueryFilter().items.length > 0) {\r\n  return;\r\n}\r\n\r\nvar dataItems = context.DataSources['MainDataSource'].getDataItems();\r\nif(dataItems.length > 0) {\r\n   context.DataSources['MainDataSource'].setSelectedItem(dataItems[0]);\r\n      \r\n   var criteria = new Criteria();\r\n   criteria.setItems([ {  \r\n      Property : 'LoginAs.Id',\r\n      Value : dataItems[0].Id,\r\n      CriteriaType : 1   \r\n   } ]);\r\n   \r\n   context.DataSources['UserLoginAsDataSource'].setQueryFilter(criteria);\r\n   context.DataSources['UserLoginAsDataSource'].resumeUpdate();\r\n}"
    }
  ],
  "DataSources": [
    {
      "DocumentDataSource": {
        "Name": "MainDataSource",
        "ConfigId": "Administration",
        "DocumentId": "User",
        "OnItemsUpdated": {
          "Name": "ViewLoaded"
        }
      }
    },
    {
      "DocumentDataSource": {
        "Name": "UserLoginAsDataSource",
        "ConfigId": "Administration",
        "DocumentId": "UserLoginAs"
      }
    }
  ],
  "LayoutPanel": {
    "StackPanel": {
      "Items": [
        {
          "Label": {
            "Text": "Пользователи, которым разрешено подключаться"
          }
        },
        {
          "DataGrid": {
            "Columns": [
              {
                "Text": "Пользователь",
                "DisplayProperty": "User.DisplayName"
              }
            ],
            "Items": {
              "PropertyBinding": {
                "DataSource": "UserLoginAsDataSource"
              }
            },
            "ToolBar": {
              "Items": [
                {
                  "ToolBarButton": {
                    "Text": "Добавить",
                    "Action": {
                      "EditAction": {
                        "View": {
                          "AutoView": {
                            "ConfigId": "Administration",
                            "DocumentId": "UserLoginAs",
                            "ViewType": "EditView",
                            "MetadataName": "EditViewAddLogin",
                            "OpenMode": "Dialog"
                          }
                        },
                        "DataSource": "MainDataSource"
                      }
                    }
                  }
                }
              ]
            }
          }
        }
      ]
    }
  }
}
